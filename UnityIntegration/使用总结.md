# Unityä¸å¿ƒç†æ£€æµ‹ç®¡ç†ç³»ç»Ÿé›†æˆ - ä½¿ç”¨æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„Unityé›†æˆæ–¹æ¡ˆï¼Œè®©ä½ å¯ä»¥ä»Unityå®¢æˆ·ç«¯å‘å¿ƒç†æ£€æµ‹ç®¡ç†ç³»ç»Ÿå‘é€æ•°æ®ã€‚è¿™ä¸ªæ–¹æ¡ˆåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ç»„ä»¶å’Œè¯¦ç»†çš„æ–‡æ¡£ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
UnityIntegration/
â”œâ”€â”€ PsychTestAPIClient.cs      # æ ¸å¿ƒAPIå®¢æˆ·ç«¯
â”œâ”€â”€ PsychTestDataModels.cs     # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ PsychTestExample.cs        # ä½¿ç”¨ç¤ºä¾‹å’ŒUI
â”œâ”€â”€ PsychTestConfig.cs         # é…ç½®ç®¡ç†
â”œâ”€â”€ PsychTestUtils.cs          # å·¥å…·ç±»
â””â”€â”€ README.md                  # è¯¦ç»†ä½¿ç”¨æŒ‡å—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥åˆ°Unityé¡¹ç›®

1. åœ¨Unityé¡¹ç›®ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ï¼š`Assets/Scripts/PsychTestSystem/`
2. å°†æ‰€æœ‰ `.cs` æ–‡ä»¶å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹
3. Unityä¼šè‡ªåŠ¨ç¼–è¯‘è¿™äº›è„šæœ¬

### 2. åŸºæœ¬ä½¿ç”¨

```csharp
using PsychTestSystem;
using UnityEngine;

public class MyPsychTestManager : MonoBehaviour
{
    private PsychTestAPIClient apiClient;

    void Start()
    {
        // è·å–APIå®¢æˆ·ç«¯ç»„ä»¶
        apiClient = GetComponent<PsychTestAPIClient>();

        // è®¢é˜…äº‹ä»¶
        apiClient.OnAuthenticationResult += OnAuthResult;
        apiClient.OnTestDataUploadResult += OnUploadResult;

        // å¼€å§‹èº«ä»½éªŒè¯
        apiClient.Authenticate();
    }

    private void OnAuthResult(bool success)
    {
        if (success)
        {
            Debug.Log("èº«ä»½éªŒè¯æˆåŠŸï¼");
            // ç°åœ¨å¯ä»¥å‘é€æ•°æ®äº†
            SendTestData();
        }
    }

    private void SendTestData()
    {
        // åˆ›å»ºæ£€æµ‹æ•°æ®
        ClientTestData testData = new ClientTestData();
        testData.student_id = "U001";
        testData.name = "å¼ ä¸‰";
        testData.gender = "ç”·";
        testData.age = 20;
        testData.class_name = "è®¡ç®—æœº1ç­";
        testData.SetTestTime(System.DateTime.Now);
        testData.SetQuestionnaireScores(8, 4, 12); // ç„¦è™‘ã€æŠ‘éƒã€å‹åŠ›
        testData.SetPhysiologicalData(85.0f, 13.2f); // å¿ƒç‡ã€è„‘ç”µalpha
        testData.ai_summary = "æ£€æµ‹å‡ºé«˜ç„¦è™‘é£é™©ï¼Œå»ºè®®è¿›ä¸€æ­¥è¯„ä¼°";

        // åˆ›å»ºPDFæ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
        byte[] pdfData = PsychTestUtils.CreateSamplePDFContent("å¼ ä¸‰", "U001", System.DateTime.Now);

        // ä¸Šä¼ æ•°æ®
        apiClient.UploadTestData(testData, pdfData);
    }

    private void OnUploadResult(TestDataUploadResult result)
    {
        Debug.Log($"æ•°æ®ä¸Šä¼ æˆåŠŸï¼è®°å½•ID: {result.id}");
    }
}
```

## ğŸ”§ ä¸»è¦åŠŸèƒ½

### 1. èº«ä»½éªŒè¯

- è‡ªåŠ¨è·å–JWTä»¤ç‰Œ
- æ”¯æŒä»¤ç‰Œåˆ·æ–°
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 2. å­¦ç”ŸéªŒè¯

```csharp
apiClient.ValidateStudent("U001");
```

### 3. æ•°æ®ä¸Šä¼ 

```csharp
// åˆ›å»ºæ£€æµ‹æ•°æ®
ClientTestData testData = new ClientTestData();
// ... è®¾ç½®æ•°æ® ...

// ä¸Šä¼ æ•°æ®
apiClient.UploadTestData(testData, pdfBytes);
```

### 4. çŠ¶æ€æŸ¥è¯¢

```csharp
apiClient.GetStudentTestStatus("U001");
```

## ğŸ“Š æ•°æ®æ¨¡å‹

### ClientTestDataï¼ˆæ£€æµ‹æ•°æ®ï¼‰

- `student_id`: å­¦å·
- `name`: å­¦ç”Ÿå§“å
- `gender`: æ€§åˆ«
- `age`: å¹´é¾„
- `class_name`: ç­çº§
- `questionnaire_scores`: é—®å·å¾—åˆ†ï¼ˆç„¦è™‘ã€æŠ‘éƒã€å‹åŠ›ï¼‰
- `physiological_data_summary`: ç”Ÿç†æ•°æ®ï¼ˆå¿ƒç‡ã€è„‘ç”µalphaï¼‰
- `ai_summary`: AIåˆ†ææ€»ç»“

### QuestionnaireScoresï¼ˆé—®å·å¾—åˆ†ï¼‰

- `anxiety`: ç„¦è™‘å¾—åˆ† (0-30)
- `depression`: æŠ‘éƒå¾—åˆ† (0-30)
- `stress`: å‹åŠ›å¾—åˆ† (0-30)

### PhysiologicalDataï¼ˆç”Ÿç†æ•°æ®ï¼‰

- `heart_rate`: å¿ƒç‡ (40-200)
- `eeg_alpha`: è„‘ç”µalphaå€¼ (1-50)

## ğŸ› ï¸ å·¥å…·ç±»åŠŸèƒ½

### PsychTestUtils

- æ•°æ®éªŒè¯ï¼š`ValidateStudentId()`, `ValidateName()`, `ValidateAge()`
- æ–‡ä»¶å¤„ç†ï¼š`GenerateSafeFileName()`, `CalculateFileSizeMB()`
- PDFç”Ÿæˆï¼š`CreateSamplePDFContent()`
- æ•°æ®éªŒè¯ï¼š`ValidateTestData()`

### PsychTestConfig

- ç¯å¢ƒé…ç½®ç®¡ç†
- å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢
- é…ç½®éªŒè¯

## ğŸ® ç¤ºä¾‹åœºæ™¯

1. **åˆ›å»ºGameObject**ï¼šå‘½åä¸º"PsychTestManager"
2. **æ·»åŠ ç»„ä»¶**ï¼š
   - `PsychTestAPIClient`
   - `PsychTestExample`ï¼ˆå¯é€‰ï¼Œç”¨äºUIæµ‹è¯•ï¼‰
3. **é…ç½®è®¾ç½®**ï¼š
   - Base URL: `http://localhost:8002`
   - Username: `admin`
   - Password: `password`

## ğŸ” APIç«¯ç‚¹

ä½ çš„å¿ƒç†æ£€æµ‹ç³»ç»Ÿæä¾›ä»¥ä¸‹ä¸»è¦APIç«¯ç‚¹ï¼š

- `POST /token` - è·å–JWTä»¤ç‰Œ
- `POST /api/client/validate-student` - éªŒè¯å­¦å·
- `POST /api/client/upload-test-data` - ä¸Šä¼ æ£€æµ‹æ•°æ®
- `GET /api/client/test-status/{student_id}` - æŸ¥è¯¢æ£€æµ‹çŠ¶æ€

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿Unityå®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®APIæœåŠ¡å™¨
2. **æ•°æ®éªŒè¯**ï¼šåœ¨å‘é€å‰éªŒè¯æ•°æ®æ ¼å¼å’ŒèŒƒå›´
3. **é”™è¯¯å¤„ç†**ï¼šè®¢é˜…`OnError`äº‹ä»¶å¤„ç†é”™è¯¯
4. **æ–‡ä»¶å¤§å°**ï¼šPDFæ–‡ä»¶å¤§å°é™åˆ¶ä¸º10MB
5. **å¼‚æ­¥æ“ä½œ**ï¼šæ‰€æœ‰APIè°ƒç”¨éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä½¿ç”¨äº‹ä»¶å›è°ƒå¤„ç†ç»“æœ

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **èº«ä»½éªŒè¯å¤±è´¥**
   - æ£€æŸ¥ç”¨æˆ·åå¯†ç 
   - ç¡®è®¤APIæœåŠ¡å™¨è¿è¡ŒçŠ¶æ€
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **æ•°æ®ä¸Šä¼ å¤±è´¥**
   - éªŒè¯å­¦å·æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥æ•°æ®æ ¼å¼
   - ç¡®è®¤PDFæ–‡ä»¶æœ‰æ•ˆæ€§

3. **ç½‘ç»œè¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
   - è°ƒæ•´è¶…æ—¶è®¾ç½®
   - æ£€æŸ¥é˜²ç«å¢™é…ç½®

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### æ‰¹é‡ä¸Šä¼ 

```csharp
private void UploadBatchData(List<ClientTestData> testDataList)
{
    StartCoroutine(UploadBatchCoroutine(testDataList));
}

private IEnumerator UploadBatchCoroutine(List<ClientTestData> testDataList)
{
    foreach (var testData in testDataList)
    {
        apiClient.UploadTestData(testData, pdfData);
        yield return new WaitForSeconds(1.0f); // é¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
    }
}
```

### è‡ªå®šä¹‰é…ç½®

```csharp
// ä½¿ç”¨ScriptableObjecté…ç½®
PsychTestConfig config = Resources.Load<PsychTestConfig>("PsychTestConfig");
apiClient.baseURL = config.BaseURL;
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•é›†æˆ**ï¼šä½¿ç”¨ç¤ºä¾‹ä»£ç æµ‹è¯•åŸºæœ¬åŠŸèƒ½
2. **è‡ªå®šä¹‰UI**ï¼šæ ¹æ®éœ€è¦ä¿®æ”¹UIç•Œé¢
3. **æ•°æ®æºé›†æˆ**ï¼šè¿æ¥ä½ çš„å®é™…æ•°æ®æº
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–æ€§èƒ½

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹è¯¦ç»†çš„README.mdæ–‡æ¡£
2. æ£€æŸ¥Unityæ§åˆ¶å°çš„è°ƒè¯•æ—¥å¿—
3. éªŒè¯APIæœåŠ¡å™¨çš„å“åº”
4. ä½¿ç”¨å·¥å…·ç±»è¿›è¡Œæ•°æ®éªŒè¯

---

**æ­å–œï¼** ä½ ç°åœ¨æ‹¥æœ‰äº†å®Œæ•´çš„Unityä¸å¿ƒç†æ£€æµ‹ç®¡ç†ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆã€‚è¿™ä¸ªæ–¹æ¡ˆæä¾›äº†ä»åŸºç¡€çš„æ•°æ®å‘é€åˆ°é«˜çº§çš„é”™è¯¯å¤„ç†å’Œé…ç½®ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ã€‚
