# 心理检测管理系统 - 启动和使用指南

## 系统架构

- **后端**: FastAPI + SQLAlchemy + SQLite
- **前端**: Vue.js + Element Plus
- **数据库**: SQLite (轻量级，无需额外安装)

## 环境要求

### 系统要求

- Windows 10/11
- Python 3.8+
- Node.js 14+
- npm 或 yarn

### 依赖包

- 后端: fastapi, sqlalchemy, uvicorn, pandas, openpyxl, python-multipart
- 前端: vue, element-plus, axios

## 快速启动

## 先激活conda环境

conda activate psy_env

### 第一步：启动后端服务

1. **打开命令行终端**，进入项目目录：

```bash
cd d:/shiyanshi_laoshi
```

2. **安装后端依赖**：

```bash
cd psy_admin_fastapi
pip install -r requirements.txt
```

3. **初始化数据库和管理员账户**：

```bash
python init_admin.py
```

- 这会创建数据库表和默认管理员账户
- 默认管理员账户：用户名 `admin`，密码 `password`

4. **启动后端服务**：

```bash
python main.py
```

- 后端将在 `http://localhost:8000` 启动
- API文档地址：`http://localhost:8000/docs`

### 第二步：启动前端服务

1. **打开新的命令行终端**，进入前端目录：

```bash
cd d:/shiyanshi_laoshi/psy_admin_vue
```

2. **安装前端依赖**：

```bash
npm install
```

3. **启动前端开发服务器**：

```bash
npm run serve
```

- 前端将在 `http://localhost:8080` 启动
- 请确保后端已经先启动

### 第三步：访问系统

1. **打开浏览器**，访问 `http://localhost:8080`
2. **使用管理员账户登录**：
   - 用户名：`admin`
   - 密码：`password`

## 详细配置说明

### 后端配置

#### 数据库配置

- 默认使用 SQLite 数据库
- 数据库文件：`psy_admin_fastapi/app.db`
- 如需修改数据库配置，编辑 `psy_admin_fastapi/config.py`

#### 管理员账户

- 初始化命令：`python init_admin.py`
- 重置密码：`python reset_admin.py`
- 检查管理员状态：`python check_admin.py`

#### 日志配置

- 日志文件：`psy_admin_fastapi/app.log`
- 日志级别：INFO

### 前端配置

#### 开发环境配置

- 开发服务器端口：8080
- API代理配置：`vue.config.js` 中已配置代理到后端 8000 端口

#### 生产环境构建

```bash
cd psy_admin_vue
npm run build
```

- 构建后的文件在 `dist/` 目录

## 功能模块说明

### 1. 学生管理

- **批量导入**: 支持Excel文件导入学生信息
- **信息管理**: 增删改查学生基本信息
- **学号验证**: 支持学号唯一性验证

### 2. 检测记录管理

- **数据查看**: 支持大图标/列表两种视图
- **多维度筛选**: 按学号、姓名、班级、时间、状态等筛选
- **批量操作**: 支持批量选择、状态更新、报告生成
- **数据导出**: 支持Excel格式导出

### 3. 仪表板统计

- **基础统计**: 学生总数、检测记录数、异常数等
- **趋势分析**: 检测趋势图表
- **分布统计**: 班级分布、得分分布等

### 4. 报告管理

- **报告生成**: 支持PDF和Excel格式
- **批量生成**: 支持批量生成多个报告
- **报告下载**: 支持在线预览和下载

## 客户端对接说明

### 核心接口

#### 1. 学号验证

```bash
POST /api/client/validate-student
Content-Type: application/json

{
  "student_id": "U001"
}
```

#### 2. 检测数据上传

```bash
POST /api/client/upload-test-data
Content-Type: multipart/form-data

pdf_file: (PDF文件)
test_data: (JSON字符串)
```

#### 3. 检测状态查询

```bash
GET /api/client/test-status/{student_id}
```

### 状态映射

| 客户端状态  | 服务端状态 | 说明   |
| ----------- | ---------- | ------ |
| not_started | pending    | 未开始 |
| in_progress | processing | 进行中 |
| completed   | completed  | 已完成 |

## 常见问题解决

### 1. 端口占用问题

- **后端端口8000被占用**：修改 `main.py` 中的 `uvicorn.run(app, host="0.0.0.0", port=8000)`
- **前端端口8080被占用**：修改 `vue.config.js` 中的 `port: 8080`

### 2. 数据库问题

- **数据库文件不存在**：运行 `python init_admin.py` 创建
- **数据库表不存在**：运行 `python init_admin.py` 重建

### 3. 依赖包问题

- **后端依赖缺失**：在 `psy_admin_fastapi` 目录运行 `pip install -r requirements.txt`
- **前端依赖缺失**：在 `psy_admin_vue` 目录运行 `npm install`

### 4. CORS问题

- 前端无法访问后端：确保 `main.py` 中CORS配置正确
- 默认允许的源：`http://localhost:8080`, `http://127.0.0.1:8080`

## 开发调试

### 后端调试

- **API文档**: `http://localhost:8000/docs`
- **ReDoc文档**: `http://localhost:8000/redoc`
- **日志查看**: 查看 `psy_admin_fastapi/app.log`

### 前端调试

- **开发者工具**: F12 打开浏览器开发者工具
- **热重载**: 代码修改后自动刷新
- **状态查看**: Vue DevTools 插件

## 测试运行

### 后端测试

```bash
cd psy_admin_fastapi
# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_api.py

# 运行客户端接口测试
python test_client_apis.py
```

### 前端测试

```bash
cd psy_admin_vue
# 运行单元测试
npm run test:unit

# 运行端到端测试
npm run test:e2e
```

## 部署说明

### 开发环境

按照上述快速启动步骤即可

### 生产环境

1. **后端部署**：

   - 使用 Gunicorn 或 Uvicorn 部署
   - 配置反向代理 (Nginx)
   - 设置环境变量
2. **前端部署**：

   - 运行 `npm run build` 构建静态文件
   - 部署到 Nginx 或其他静态文件服务器
   - 配置正确的 API 地址
3. **数据库**：

   - 建议使用 PostgreSQL 或 MySQL
   - 定期备份数据库

## 联系方式

如有问题或建议，请参考项目文档或联系开发团队。
